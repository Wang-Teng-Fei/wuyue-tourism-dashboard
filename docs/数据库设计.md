# 五岳智游数据可视化 - 数据库概述

## 数据库配置

### 数据库名称

`wuyue_data_warehouse`

### .env数据库配置

~~~php
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=wuyue_data_warehouse
DB_USERNAME=root
DB_PASSWORD=123456
~~~



## 数据表

### flyline_charts 表结构

飞线图信息

| 字段名           | 类型            | 描述           | 备注               |
| ---------------- | --------------- | -------------- | ------------------ |
| id               | BIGINT UNSIGNED | 主键，自增 ID  |                    |
| name             | VARCHAR(255)    | 飞线图名称     | 唯一               |
| points           | JSON            | 坐标点数组     | 必填               |
| lines            | JSON            | 飞线数组       | 必填               |
| description      | VARCHAR(255)    | 飞线图描述     | 必填               |
| main_image       | VARCHAR(255)    | 主图路径或 URL | 必填               |
| sub_image        | VARCHAR(255)    | 附图路径或 URL | 可为空             |
| point_image_path | VARCHAR(255)    | 普通点图片路径 | 可为空             |
| extra_config     | JSON            | 飞线图额外配置 | 可为空，存全局配置 |
| created_at       | TIMESTAMP       | 创建时间       | Laravel 自动维护   |
| updated_at       | TIMESTAMP       | 更新时间       | Laravel 自动维护   |

---

### flyline_center_points 表结构

飞线图中心点图标

| 字段名       | 类型             | 描述           | 备注               |
| ------------ | ---------------- | -------------- | ------------------ |
| id           | BIGINT UNSIGNED  | 主键，自增 ID  |                    |
| name         | VARCHAR(100)     | 中心点名字     | 唯一               |
| image_path   | VARCHAR(255)     | 中心点图片路径 | 必填               |
| width        | UNSIGNED INTEGER | 图标宽度       | 默认 30            |
| height       | UNSIGNED INTEGER | 图标高度       | 默认 30            |
| halo_config  | JSON             | 光环配置       | 可为空             |
| text_config  | JSON             | 文本配置       | 可为空             |
| extra_config | JSON             | 额外配置       | 可为空，存全局配置 |
| created_at   | TIMESTAMP        | 创建时间       | Laravel 自动维护   |
| updated_at   | TIMESTAMP        | 更新时间       | Laravel 自动维护   |

---

### mountain_ids 表结构

山脉信息

| 字段名     | 类型            | 描述                            | 备注             |
| ---------- | --------------- | ------------------------------- | ---------------- |
| id         | BIGINT UNSIGNED | 主键 ID，自增，唯一标识一座山峰 |                  |
| name       | VARCHAR(50)     | 山峰名称                        | 唯一             |
| province   | VARCHAR(50)     | 山峰所在省份                    | 必填             |
| created_at | TIMESTAMP       | 创建时间                        | Laravel 自动维护 |
| updated_at | TIMESTAMP       | 更新时间                        | Laravel 自动维护 |

---

### monthly_tourist_stats 表结构

月度游客和收入统计

| 字段名        | 类型             | 描述                          | 备注                             |
| ------------- | ---------------- | ----------------------------- | -------------------------------- |
| id            | BIGINT UNSIGNED  | 主键，自增 ID                 |                                  |
| mountain_id   | BIGINT UNSIGNED  | 外键，关联 mountain_ids 表 id | 删除山峰时，相关月度记录级联删除 |
| year          | INT              | 年份（数据所属年份）          |                                  |
| month         | TINYINT UNSIGNED | 月份（1-12）                  |                                  |
| tourist_count | INT              | 当月游客人数                  | 默认 NULL                        |
| income        | DECIMAL(15,2)    | 当月收入，单位元              | 默认 NULL                        |
| created_at    | TIMESTAMP        | 创建时间                      | Laravel 自动维护                 |
| updated_at    | TIMESTAMP        | 更新时间                      | Laravel 自动维护                 |

**索引**  
- `unique_mountain_year_month`：复合唯一索引（`mountain_id`, `year`, `month`），防止重复数据  

---

### annual_stats 表结构

年度山高及植被覆盖率

| 字段名              | 类型            | 描述                          | 备注                             |
| ------------------- | --------------- | ----------------------------- | -------------------------------- |
| id                  | BIGINT UNSIGNED | 主键，自增 ID                 |                                  |
| mountain_id         | BIGINT UNSIGNED | 外键，关联 mountain_ids 表 id | 删除山峰时，相关年度记录级联删除 |
| year                | INT             | 年份（数据所属年份）          |                                  |
| height              | DECIMAL(8,2)    | 山峰高度（单位：米）          | 默认 NULL                        |
| vegetation_coverage | DECIMAL(5,2)    | 植被覆盖率（0~100%）          | 默认 NULL                        |
| created_at          | TIMESTAMP       | 创建时间                      | Laravel 自动维护                 |
| updated_at          | TIMESTAMP       | 更新时间                      | Laravel 自动维护                 |

**索引**  
- `unique_mountain_year`：复合唯一索引（`mountain_id`, `year`），保证每座山每年只有一条记录  

---

### visualization_configs 表结构

可视化配置

| 字段名           | 类型            | 描述                              | 备注                                 |
| ---------------- | --------------- | --------------------------------- | ------------------------------------ |
| id               | BIGINT UNSIGNED | 主键，自增 ID                     |                                      |
| name             | VARCHAR(100)    | 配置名称（唯一）                  | 唯一索引                             |
| flyline_chart_id | BIGINT UNSIGNED | 飞线图 ID，关联 flyline_charts.id | 外键，删除飞线图时，级联删除相关配置 |
| mountain_ids     | JSON            | 要展示的山脉 ID 数组              |                                      |
| year             | INT             | 数据年份                          |                                      |
| background_image | VARCHAR(255)    | 背景图片路径或 URL                | 可为空                               |
| config_json      | JSON            | 额外配置，如颜色、大小、动画等    | 可为空                               |
| is_active        | TINYINT(1)      | 是否启用，0=禁用，1=启用          | 默认 0                               |
| created_at       | TIMESTAMP       | 创建时间                          | Laravel 自动维护                     |
| updated_at       | TIMESTAMP       | 更新时间                          | Laravel 自动维护                     |

---

### admins 表结构

管理员信息

| 字段名        | 类型            | 描述                                             | 备注             |
| ------------- | --------------- | ------------------------------------------------ | ---------------- |
| id            | BIGINT UNSIGNED | 主键，自增 ID                                    |                  |
| name          | VARCHAR(50)     | 管理员姓名或用户名                               |                  |
| email         | VARCHAR(100)    | 登录邮箱，唯一                                   | 唯一索引         |
| password      | VARCHAR         | 密码（加密存储）                                 |                  |
| role          | VARCHAR(20)     | 管理员角色，super(超级管理员)，admin(普通管理员) | 默认 admin       |
| token         | VARCHAR(100)    | 记住我或 API Token                               | 可为空           |
| status        | TINYINT         | 状态：1=启用，0=禁用                             | 默认 1           |
| avatar        | VARCHAR(255)    | 头像 URL 或路径                                  |                  |
| last_login_at | TIMESTAMP       | 最后登录时间                                     | 可为空           |
| created_at    | TIMESTAMP       | 创建时间                                         | Laravel 自动维护 |
| updated_at    | TIMESTAMP       | 更新时间                                         | Laravel 自动维护 |

- 每座山（mountains）可以有多条月度统计记录（monthly_tourist_stats）  
- 每座山每年只有一条年度统计记录（annual_stats）  
- 配置表是用来配置可视化界面的数据
- admins 独立表，与山脉表无直接关系